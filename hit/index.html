<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treino HIIT Minimalista</title>
    <!-- Carrega Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Definindo as cores da paleta para f√°cil refer√™ncia no CSS e JS */
        :root {
            --color-bg-primary: #1A1A2E; /* Azul escuro principal */
            --color-bg-secondary: #2C2C44; /* Azul roxo escuro para cards */
            --color-bg-tertiary: #1F1F38; /* Fundo de elementos internos (cron√¥metro, select) */
            --color-text-light: #E0E0E0; /* Texto quase branco */
            --color-accent-red: #FF6B6B; /* Vermelho mais suave para corrida/a√ß√£o principal */
            --color-accent-blue: #6BADEF; /* Azul mais suave para caminhada/informa√ß√£o */
            --color-accent-yellow: #FFD166; /* Amarelo/Ouro mais suave para acelera√ß√£o/alerta */
            --color-button-hover-red: #E05C5C; /* Hover do vermelho */
            --color-button-hover-blue: #5C9FD8; /* Hover do azul */
            --color-button-hover-yellow: #E0B85C; /* Hover do amarelo */
            --color-text-dark: #1A1A2E; /* Texto escuro para contraste em backgrounds claros */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-primary);
            color: var(--color-text-light);
            transition: background-color 0.3s;
        }
        
        /* Estilo para o grande n√∫mero do cron√¥metro (Mobile First) */
        .timer-display {
            font-size: 5rem; /* Menor em mobile */
            font-weight: 900;
            line-height: 1;
            letter-spacing: -2px;
            text-shadow: 0 4px 10px rgba(255, 107, 107, 0.2); /* Sombra mais suave */
        }
        /* Ajuste para telas maiores */
        @media (min-width: 640px) {
            .timer-display {
                font-size: 9rem; /* Maior em desktop */
            }
        }

        /* Estilo para o contador 3-2-1 */
        .countdown {
            font-size: 10rem; /* Ajustado para mobile */
            color: var(--color-accent-red);
            animation: pulse 0.5s infinite alternate;
        }
        @keyframes pulse {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(1.05); opacity: 0.7; }
        }
        /* Efeito de bot√£o pressionado */
        .btn-control:active {
            transform: scale(0.98);
        }
        
        /* Estilo para o painel de destaque do intervalo atual */
        .highlight-run {
            background-color: var(--color-accent-red);
            border-bottom: 6px solid var(--color-button-hover-red);
        }
        .highlight-walk {
            background-color: var(--color-accent-blue);
            border-bottom: 6px solid var(--color-button-hover-blue);
        }
        .highlight-ramp {
            background-color: var(--color-accent-yellow);
            border-bottom: 6px solid var(--color-button-hover-yellow);
            color: var(--color-text-dark); /* Garante bom contraste no texto */
        }
        
        /* Ajuste do T√≠tulo para Mobile */
        .app-title {
            font-size: 2rem; /* Tamanho base menor */
        }
        @media (min-width: 640px) {
            .app-title {
                font-size: 3rem;
            }
        }

        /* Estilos para o alerta de 10 segundos */
        #next-step-alert {
            background-color: var(--color-bg-secondary); /* Cor de fundo do card principal */
            border-radius: 1rem; /* Arredondamento do card */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1); /* Sombra consistente */
        }
        
        /* Novo estilo para o container que encapsula o timer e a velocidade, para ser coberto pelo alerta */
        .main-display-container {
             /* Define uma altura m√≠nima para evitar que o layout se mova */
            min-height: 20rem; /* Ajuste conforme necess√°rio para acomodar os dois boxes */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start sm:justify-center p-4">

    <div id="app" class="w-full max-w-sm sm:max-w-md bg-[--color-bg-secondary] p-6 rounded-2xl shadow-2xl space-y-8 border-t-4 border-[--color-accent-red]">
        <!-- T√çTULO ATUALIZADO: HIIT --><h1 class="app-title font-extrabold text-center text-[--color-accent-red] uppercase tracking-wide">HIIT</h1>

        <!-- 1. Configura√ß√£o do Treino (Vis√≠vel antes de come√ßar) --><div id="config-panel" class="space-y-6">
            <div class="space-y-2">
                <label for="difficulty" class="block text-sm font-semibold text-[--color-text-light]">N√≠vel de Dificuldade:</label>
                <select id="difficulty" onchange="updatePreview()" class="w-full p-3 rounded-xl bg-[--color-bg-tertiary] border border-gray-600 focus:ring-4 focus:ring-[--color-accent-red]/50 focus:border-[--color-accent-red] transition duration-200 appearance-none cursor-pointer text-base">
                    <option value="easy">F√°cil (1:1)</option>
                    <option value="medium" selected>M√©dio (C/ Acelera√ß√£o)</option>
                    <option value="hard">Dif√≠cil (C/ Acelera√ß√£o)</option>
                    <option value="extreme">Extremo (C/ Acelera√ß√£o)</option>
                </select>
            </div>
            <div class="space-y-2">
                <label for="duration" class="block text-sm font-semibold text-[--color-text-light]">Dura√ß√£o Total (minutos):</label>
                <select id="duration" onchange="updatePreview()" class="w-full p-3 rounded-xl bg-[--color-bg-tertiary] border border-gray-600 focus:ring-4 focus:ring-[--color-accent-red]/50 focus:border-[--color-accent-red] transition duration-200 appearance-none cursor-pointer text-base">
                    <option value="5">5 min</option>
                    <option value="10">10 min</option>
                    <option value="15" selected>15 min</option>
                    <option value="20">20 min</option>
                    <option value="25">25 min</option>
                    <option value="30">30 min</option>
                </select>
            </div>

            <!-- Painel de Pr√©-visualiza√ß√£o --><div id="preview-panel" class="bg-[--color-bg-tertiary] p-4 rounded-xl shadow-inner border border-gray-700 max-h-48 overflow-y-auto space-y-2">
                <p class="text-sm font-bold text-[--color-accent-red] mb-2">PR√â-VISUALIZA√á√ÉO DO TREINO</p>
                <div id="preview-list" class="space-y-1 text-xs">
                    <!-- Conte√∫do gerado via JS --></div>
            </div>

            <button onclick="startCountdown()" id="start-btn-initial" class="btn-control w-full py-4 bg-[--color-accent-red] hover:bg-[--color-button-hover-red] text-white font-extrabold rounded-xl shadow-lg shadow-[--color-accent-red]/40 transition duration-150 transform hover:-translate-y-0.5">
                COME√áAR
            </button>
        </div>

        <!-- 2. Display do Cron√¥metro e Velocidades (Vis√≠vel durante o treino) --><div id="workout-panel" class="hidden text-center space-y-6">
            
            <!-- T√≠tulo do Intervalo e Tempo Total Restante --><div id="interval-header" class="p-3 rounded-lg shadow-md transition duration-300">
                <p id="current-interval-type" class="text-xl font-bold uppercase text-[--color-text-light] sm:text-2xl">PREPARAR</p>
                <p class="text-sm text-[--color-text-light] mt-1">Total Restante: <span id="total-time-remaining" class="font-mono">--:--</span></p>
            </div>

            <!-- Container da √Årea Principal do Display (Relativo para Alerta) --><div class="relative main-display-container"> 
                
                <!-- NOVO: Alerta de Pr√≥ximo Passo (10 segundos) - Agora ocupa todo o espa√ßo do container para substituir o display principal -->
                <div id="next-step-alert" class="hidden absolute inset-0 rounded-xl flex flex-col items-center justify-center p-4 z-20 transition-opacity duration-300">
                    
                    <!-- Titulo do alerta na posi√ß√£o do Cron√¥metro/Velocidade -->
                    <div class="flex flex-col items-center justify-center w-full h-40 sm:h-48 bg-[--color-bg-tertiary] rounded-xl shadow-inner border border-gray-700">
                        <!-- FONTE AJUSTADA: text-xl sm:text-3xl -->
                        <p class="text-xl sm:text-3xl font-bold text-[--color-accent-yellow] uppercase tracking-wider">AJUSTE A VELOCIDADE!</p>
                        <p id="alert-countdown" class="text-8xl sm:text-9xl font-extrabold text-[--color-accent-yellow] leading-none mb-6">10</p>
                    </div>

                    <!-- Pr√≥xima Velocidade na posi√ß√£o da Velocidade Sugerida -->
                    <div class="bg-[--color-bg-tertiary] p-4 rounded-xl shadow-md border-l-4 border-[--color-accent-yellow] mt-4 w-full">
                        <p class="text-sm font-semibold text-gray-300 mb-1">PR√ìXIMA VELOCIDADE (km/h)</p>
                        <!-- FONTE AJUSTADA: text-3xl sm:text-4xl -->
                        <p id="next-speed-display" class="text-3xl sm:text-4xl font-extrabold text-[--color-text-light] transition duration-300">--</p>
                    </div>

                </div>

                <!-- Wrapper para Cron√¥metro e Velocidade (Vis√≠vel quando o alerta est√° escondido) --><div id="main-display-content">
                    <!-- Contador de Tempo --><div id="timer-box" class="flex flex-col items-center justify-center h-40 sm:h-48 bg-[--color-bg-tertiary] rounded-xl shadow-inner border border-gray-700">
                        <!-- 3-2-1 Countdown --><div id="countdown-display" class="countdown hidden">3</div>
                        <!-- Main Timer --><div id="main-timer-display" class="timer-display text-[--color-accent-red]">00:00</div>
                    </div>

                    <!-- Velocidade Sugerida --><div id="speed-box" class="bg-[--color-bg-tertiary] p-4 rounded-xl shadow-md border-l-4 border-[--color-accent-blue] mt-4">
                        <p class="text-sm font-semibold text-gray-300 mb-1">VELOCIDADE SUGERIDA (km/h)</p>
                        <p id="speed-display" class="text-4xl sm:text-5xl font-extrabold text-[--color-accent-blue] transition duration-300">--</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Controles do Treino (Vis√≠vel durante/depois do treino) --><div id="controls-panel" class="flex justify-center space-x-2 pt-2 sm:space-x-4">
            <button onclick="pauseWorkout()" id="pause-btn" class="btn-control hidden flex-1 py-3 bg-[--color-accent-yellow] hover:bg-[--color-button-hover-yellow] text-[--color-text-dark] font-semibold rounded-xl shadow-md transition duration-150 text-sm sm:text-base">
                PAUSAR
            </button>
            <!-- BOT√ÉO PARAR: VERMELHO E S√ì APARECE EM ESTADO PAUSADO --><button onclick="stopWorkout()" id="stop-btn" class="btn-control hidden flex-1 py-3 bg-[--color-accent-red] hover:bg-[--color-button-hover-red] text-white font-semibold rounded-xl shadow-md transition duration-150 text-sm sm:text-base">
                PARAR
            </button>
            <button onclick="startWorkout()" id="resume-btn" class="btn-control hidden flex-1 py-3 bg-[--color-accent-blue] hover:bg-[--color-button-hover-blue] text-white font-semibold rounded-xl shadow-md transition duration-150 text-sm sm:text-base">
                CONTINUAR
            </button>
            <button onclick="resetWorkout()" id="reset-btn" class="btn-control hidden w-full py-4 bg-[--color-accent-red] hover:bg-[--color-button-hover-red] text-white font-extrabold rounded-xl shadow-lg transition duration-150">
                RESETAR
            </button>
        </div>

        <!-- Mensagem de Conclus√£o --><div id="finished-message" class="hidden text-center mt-6 p-4 bg-green-900/50 rounded-xl border border-green-700">
            <p class="text-2xl font-bold text-green-400">TREINO CONCLU√çDO! üéâ</p>
            <p class="text-gray-400">√ìtimo trabalho! Clique em RESETAR para come√ßar de novo.</p>
        </div>

    </div>

    <script>
        // --- CONFIGURA√á√ïES E VARI√ÅVEIS DE ESTADO ---

        // Configura√ß√µes predefinidas para os n√≠veis de dificuldade
        // Os intervalos (runDuration, walkDuration, rampDuration) s√£o agora 30s, 60s ou 120s.
        const WORKOUT_PROFILES = {
            // Easy: runSpeed ajustado para 7.0 km/h
            easy: { runSpeed: 7.0, walkSpeed: 5.0, runDuration: 60, walkDuration: 60, runRatio: '1:1', rampDuration: 0 }, 
            // M√©dio: 1:1 (com 30s de acelera√ß√£o), ajustado de 45s para 60s de caminhada.
            medium: { runSpeed: 10.0, walkSpeed: 5.5, runDuration: 60, walkDuration: 60, runRatio: '1:1', rampDuration: 30 }, 
            // Hard: 2:1 (com 30s de acelera√ß√£o), 30s de caminhada.
            hard: { runSpeed: 12.0, walkSpeed: 6.0, runDuration: 60, walkDuration: 30, runRatio: '2:1', rampDuration: 30 }, 
            // Extremo: 2:1 (com 30s de acelera√ß√£o), ajustado de 20s para 30s de caminhada.
            extreme: { runSpeed: 14.0, walkSpeed: 6.5, runDuration: 60, walkDuration: 30, runRatio: '2:1', rampDuration: 30 }, 
        };

        // Estado do Treino
        let state = 'stopped'; // 'stopped', 'countdown', 'running', 'paused', 'finished'
        let timerInterval;
        let profile = null;

        // Estrutura do Treino
        let workoutSteps = [];
        let currentStepIndex = 0;
        let stepTimeRemaining = 0;

        // --- REFER√äNCIAS DOM ---
        const configPanel = document.getElementById('config-panel');
        const workoutPanel = document.getElementById('workout-panel');
        const controlsPanel = document.getElementById('controls-panel');
        const startBtnInitial = document.getElementById('start-btn-initial');
        const pauseBtn = document.getElementById('pause-btn');
        const stopBtn = document.getElementById('stop-btn');
        const resumeBtn = document.getElementById('resume-btn');
        const resetBtn = document.getElementById('reset-btn');
        const countdownDisplay = document.getElementById('countdown-display');
        const mainTimerDisplay = document.getElementById('main-timer-display');
        const totalTimeRemainingDisplay = document.getElementById('total-time-remaining');
        const currentIntervalTypeDisplay = document.getElementById('current-interval-type');
        const speedDisplay = document.getElementById('speed-display');
        const finishedMessage = document.getElementById('finished-message');
        const difficultySelect = document.getElementById('difficulty');
        const durationSelect = document.getElementById('duration');
        const previewList = document.getElementById('preview-list');
        const intervalHeader = document.getElementById('interval-header');

        // NOVAS REFER√äNCIAS PARA O ALERTA E DISPLAY PRINCIPAL
        const nextStepAlert = document.getElementById('next-step-alert');
        const alertCountdown = document.getElementById('alert-countdown');
        const nextSpeedDisplay = document.getElementById('next-speed-display');
        const mainDisplayContent = document.getElementById('main-display-content'); // Novo wrapper

        // --- FUN√á√ïES DE √ÅUDIO ---
        
        /**
         * Toca um bipe simples usando a Web Audio API.
         * @param {number} frequency - Frequ√™ncia em Hz.
         * @param {number} duration - Dura√ß√£o em ms.
         */
        function playBeep(frequency = 440, duration = 150) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;

            try {
                const context = new AudioContext();
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(context.destination);

                // Configura√ß√µes do som
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(frequency, context.currentTime);

                // Configura√ß√µes de volume (rampa para evitar clique ao parar)
                gainNode.gain.setValueAtTime(0.5, context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, context.currentTime + duration / 1000);

                // Inicia e para o som
                oscillator.start();
                oscillator.stop(context.currentTime + duration / 1000);
            } catch (e) {
                console.error("Web Audio API error:", e);
                // Permite que o aplicativo continue rodando mesmo sem suporte a √°udio
            }
        }


        // --- FUN√á√ïES DE UTILIDADE E GERA√á√ÉO DE PASSOS ---

        /**
         * Formata segundos para MM:SS
         * @param {number} totalSeconds
         * @returns {string}
         */
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        /**
         * Calcula o tempo total restante no treino.
         * @returns {number}
         */
        function calculateTotalTimeRemaining() {
            let remaining = stepTimeRemaining;
            for (let i = currentStepIndex + 1; i < workoutSteps.length; i++) {
                remaining += workoutSteps[i].duration;
            }
            return remaining;
        }

        /**
         * Gera a sequ√™ncia de passos do treino (Corrida/Caminhada)
         * @param {string} difficultyValue
         * @param {string} durationValue
         * @returns {Array<Object>} Lista de passos do treino.
         */
        function createWorkoutSteps(difficultyValue, durationValue) {
            const selectedProfile = WORKOUT_PROFILES[difficultyValue];
            const steps = [];
            const totalDurationMinutes = parseInt(durationValue);
            const totalDurationSeconds = totalDurationMinutes * 60;
            const runDuration = selectedProfile.runDuration;
            const walkDuration = selectedProfile.walkDuration;
            const rampDuration = selectedProfile.rampDuration;
            
            // Calcula a velocidade intermedi√°ria (m√©dia entre caminhada e corrida)
            const rampSpeed = (selectedProfile.walkSpeed + selectedProfile.runSpeed) / 2;

            let timeElapsed = 0;

            // 1. Aquecimento (Walk - 1 min)
            steps.push({ 
                type: 'walk', 
                duration: 60, 
                speed: selectedProfile.walkSpeed, 
                label: 'AQUECIMENTO',
                icon: 'üî•'
            });
            timeElapsed += 60;

            let cycle = 1;

            // 2. Adiciona ciclos Run/Walk at√© o tempo total ser atingido
            while (timeElapsed < totalDurationSeconds) {
                
                // --- RAMP-UP (ACELERA√á√ÉO - Velocidade Intermedi√°ria) ---
                if (rampDuration > 0 && timeElapsed < totalDurationSeconds) {
                    let duration = Math.min(rampDuration, totalDurationSeconds - timeElapsed);
                    if (duration > 0) {
                        steps.push({
                            type: 'ramp', 
                            duration: duration,
                            speed: rampSpeed,
                            label: `ACELERA√á√ÉO (Ciclo ${cycle})`,
                            icon: 'üöÄ'
                        });
                        timeElapsed += duration;
                    }
                }

                // CORRIDA (High Intensity)
                if (timeElapsed < totalDurationSeconds) {
                    let duration = Math.min(runDuration, totalDurationSeconds - timeElapsed);
                    if (duration > 0) {
                        steps.push({ 
                            type: 'run', 
                            duration: duration, 
                            speed: selectedProfile.runSpeed,
                            label: `CORRIDA (Ciclo ${cycle})`,
                            icon: '‚ö°'
                        });
                        timeElapsed += duration;
                    }
                }

                // CAMINHADA (Recovery/Low Intensity)
                if (timeElapsed < totalDurationSeconds) {
                    let duration = Math.min(walkDuration, totalDurationSeconds - timeElapsed);
                    if (duration > 0) {
                        steps.push({ 
                            type: 'walk', 
                            duration: duration, 
                            speed: selectedProfile.walkSpeed,
                            label: `CAMINHADA (Ciclo ${cycle})`,
                            icon: 'üê¢'
                        });
                        timeElapsed += duration;
                    }
                }
                cycle++;
            }

            // 3. Desacelera√ß√£o (Cool Down - 1 min, se houver tempo)
            // Se sobrou tempo suficiente para uma desacelera√ß√£o, adiciona um passo final de 1 minuto
            const finalCooldownTime = 60;
            if (totalDurationSeconds - timeElapsed >= finalCooldownTime) {
                 steps.push({ 
                    type: 'walk', 
                    duration: finalCooldownTime, 
                    speed: selectedProfile.walkSpeed, 
                    label: 'DESACELERA√á√ÉO',
                    icon: 'üßò'
                });
            // Se sobrou algum tempo, mas menos que 1 minuto, usa o tempo restante
            } else if (totalDurationSeconds > timeElapsed) {
                 steps.push({ 
                    type: 'walk', 
                    duration: totalDurationSeconds - timeElapsed, 
                    speed: selectedProfile.walkSpeed, 
                    label: 'DESACELERA√á√ÉO',
                    icon: 'üßò'
                });
            }

            return steps;
        }

        // --- FUN√á√ïES DE PR√â-VISUALIZA√á√ÉO ---

        /**
         * Gera e exibe a pr√©-visualiza√ß√£o do treino.
         */
        function updatePreview() {
            const difficultyValue = difficultySelect.value;
            const durationValue = durationSelect.value;
            
            const steps = createWorkoutSteps(difficultyValue, durationValue);

            let html = '';
            let totalTime = 0;

            steps.forEach((step, index) => {
                totalTime += step.duration;
                const timeStr = formatTime(step.duration);
                const speedStr = step.speed.toFixed(1);

                let typeClass;
                let speedColor;

                if (step.type === 'run') {
                    typeClass = 'text-[--color-accent-red] font-medium';
                    speedColor = 'var(--color-accent-red)';
                } else if (step.type === 'walk') {
                    typeClass = 'text-[--color-accent-blue]';
                    speedColor = 'var(--color-accent-blue)';
                } else if (step.type === 'ramp') {
                    typeClass = 'text-[--color-accent-yellow] font-medium';
                    speedColor = 'var(--color-accent-yellow)';
                }
                
                html += `
                    <p class="flex justify-between items-center px-2 py-1 bg-[--color-bg-secondary] rounded-lg">
                        <span class="text-gray-400">${step.icon} Passo ${index + 1}: ${step.label.split(' ')[0]}</span>
                        <span class="${typeClass} text-right" style="color:${speedColor}">
                            ${timeStr} @ ${speedStr} km/h
                        </span>
                    </p>
                `;
            });
            
            // Total calculado real
            const totalTimeMinutes = Math.floor(totalTime / 60);

            previewList.innerHTML = `
                ${html}
                <div class="pt-2 mt-2 border-t border-gray-700 text-gray-300 font-bold flex justify-between">
                    <span>Dura√ß√£o Total Estimada:</span> 
                    <span class="text-[--color-text-light]">${totalTimeMinutes} minutos</span>
                </div>
            `;
        }

        // --- FUN√á√ïES DE ESTADO E EXIBI√á√ÉO ---

        /**
         * Atualiza a interface (bot√µes e pain√©is) com base no estado atual.
         */
        function updateUI() {
            // Remove classes de destaque
            intervalHeader.classList.remove('highlight-run', 'highlight-walk', 'highlight-ramp');
            
            // Esconde/mostra pain√©is
            configPanel.classList.toggle('hidden', state !== 'stopped');
            workoutPanel.classList.toggle('hidden', state === 'stopped');
            finishedMessage.classList.add('hidden');
            nextStepAlert.classList.add('hidden'); // Garante que o alerta est√° escondido em estados n√£o-run

            // L√≥gica dos bot√µes: Limpa todos os bot√µes e remove classes de layout
            startBtnInitial.classList.add('hidden'); 
            pauseBtn.classList.add('hidden');
            stopBtn.classList.add('hidden'); // Ocultado por padr√£o
            resumeBtn.classList.add('hidden');
            resetBtn.classList.add('hidden');
            controlsPanel.classList.remove('space-x-2', 'space-x-4', 'justify-center');
            
            // Controle de visibilidade do painel principal de controles
            controlsPanel.classList.remove('hidden');

            if (state === 'stopped') {
                configPanel.classList.remove('hidden');
                startBtnInitial.classList.remove('hidden');
                controlsPanel.classList.add('hidden'); // Esconde o painel de controles se estiver em 'stopped'
            } else if (state === 'countdown' || state === 'running') {
                // Durante Countdown e Running, s√≥ mostramos PAUSAR
                controlsPanel.classList.add('space-x-2', 'justify-center');
                pauseBtn.classList.remove('hidden');

            } else if (state === 'paused') {
                // Durante Paused, mostramos CONTINUAR e PARAR (VERMELHO)
                controlsPanel.classList.add('space-x-2', 'justify-center');
                resumeBtn.classList.remove('hidden');
                stopBtn.classList.remove('hidden'); 
                
            } else if (state === 'finished') {
                workoutPanel.classList.add('hidden');
                finishedMessage.classList.remove('hidden');
                resetBtn.classList.remove('hidden');
                controlsPanel.classList.add('justify-center');
            }
        }

        /**
         * Atualiza todos os textos do cron√¥metro e velocidade.
         */
        function updateDisplay() {
            // Remove classes de destaque
            intervalHeader.classList.remove('highlight-run', 'highlight-walk', 'highlight-ramp');
            
            if (state === 'stopped' || state === 'finished') {
                mainTimerDisplay.textContent = formatTime(0);
                totalTimeRemainingDisplay.textContent = formatTime(0);
                speedDisplay.textContent = '--';
                currentIntervalTypeDisplay.textContent = 'PRONTO!';
                return;
            }

            const totalRemaining = calculateTotalTimeRemaining();
            mainTimerDisplay.textContent = formatTime(stepTimeRemaining);
            totalTimeRemainingDisplay.textContent = formatTime(totalRemaining);

            if (state === 'running' || state === 'paused' || state === 'countdown') {
                // Durante o countdown, n√£o h√° step ativo ainda, mas precisamos do display do workout
                if (state === 'countdown') return;

                const step = workoutSteps[currentStepIndex];
                let typeText = step.label;
                let speed = step.speed;

                currentIntervalTypeDisplay.textContent = typeText;
                speedDisplay.textContent = speed.toFixed(1);

                // Destaque de cor
                if(step.type === 'run') {
                    intervalHeader.classList.add('highlight-run');
                    currentIntervalTypeDisplay.classList.remove('text-[--color-text-dark]'); // Garante texto claro
                } else if (step.type === 'walk') {
                    intervalHeader.classList.add('highlight-walk');
                    currentIntervalTypeDisplay.classList.remove('text-[--color-text-dark]'); // Garante texto claro
                } else if (step.type === 'ramp') {
                    intervalHeader.classList.add('highlight-ramp');
                    currentIntervalTypeDisplay.classList.add('text-[--color-text-dark]'); // Ajusta texto para cor de fundo clara
                }
            }
        }


        // --- FUN√á√ïES DE CONTROLE DO TREINO ---

        /**
         * Inicia o contador 3-2-1.
         */
        function startCountdown() {
            // 1. Configura o Treino usando os valores de sele√ß√£o
            const difficultyValue = difficultySelect.value;
            const durationValue = durationSelect.value;
            profile = WORKOUT_PROFILES[difficultyValue];
            workoutSteps = createWorkoutSteps(difficultyValue, durationValue);
            
            // Re-inicializa o estado do passo
            currentStepIndex = 0;
            stepTimeRemaining = workoutSteps.length > 0 ? workoutSteps[0].duration : 0;

            // 2. Transiciona o Estado para Countdown
            state = 'countdown';
            updateUI();
            // N√ÇO chama updateDisplay(), pois a contagem regressiva usa o display pr√≥prio
            
            let count = 3;
            countdownDisplay.textContent = count;
            countdownDisplay.classList.remove('hidden');
            mainTimerDisplay.classList.add('hidden');
            currentIntervalTypeDisplay.textContent = 'PREPARE-SE!';

            timerInterval = setInterval(() => {
                // Se o estado mudou para 'paused' ou 'stopped' durante o countdown
                if (state !== 'countdown') {
                    clearInterval(timerInterval);
                    return;
                }

                count--;
                if (count > 0) {
                    countdownDisplay.textContent = count;
                    playBeep(600, 150); // Bipe de contagem
                } else if (count === 0) {
                    countdownDisplay.textContent = 'VAI!';
                    playBeep(900, 300); // Bipe longo para VAI
                } else {
                    clearInterval(timerInterval);
                    countdownDisplay.classList.add('hidden');
                    mainTimerDisplay.classList.remove('hidden');
                    startWorkout();
                }
            }, 1000);
        }

        /**
         * Inicia ou Continua o treino (ap√≥s o countdown ou pausa).
         */
        function startWorkout() {
            // Se estiver em countdown, o estado ser√° alterado abaixo. Se estiver running/finished, retorna.
            if (state === 'running' || state === 'finished' || workoutSteps.length === 0) return;

            state = 'running';
            updateUI();
            updateDisplay(); 

            timerInterval = setInterval(() => {
                // 1. Decrementa o tempo restante do passo atual
                stepTimeRemaining--;

                // --- L√≥gica do Alerta de 10 Segundos ---
                const nextStep = workoutSteps[currentStepIndex + 1];
                const isFinalStep = currentStepIndex >= workoutSteps.length - 1;

                if (!isFinalStep) {
                    // Oculta os elementos principais e mostra o alerta nos √∫ltimos 10 segundos
                    const isAlertTime = stepTimeRemaining <= 10 && stepTimeRemaining > 0;
                    
                    if (isAlertTime) {
                        nextStepAlert.classList.remove('hidden');
                        
                        // Garante que o display principal do cron√¥metro e velocidade estejam ocultos
                        mainDisplayContent.classList.add('hidden');

                        if (stepTimeRemaining === 10) {
                            // Configura√ß√£o inicial do alerta
                            const nextLabel = nextStep.label.split(' ')[0].toUpperCase();
                            // Atualiza a velocidade no alerta. O tempo de transi√ß√£o (10s) ser√° mostrado pelo alertCountdown.
                            nextSpeedDisplay.textContent = `${nextStep.speed.toFixed(1)} km/h (${nextLabel})`;
                            playBeep(400, 100); // Som de aviso
                        }
                        
                        // Atualiza a contagem regressiva do alerta
                        alertCountdown.textContent = stepTimeRemaining;
                        
                        // Bipes mais r√°pidos nos √∫ltimos 5 segundos
                        if (stepTimeRemaining <= 5) {
                            playBeep(700, 100); 
                        }
                    } else {
                        // Fora do tempo de alerta, esconde o alerta e mostra os displays principais
                        nextStepAlert.classList.add('hidden');
                        mainDisplayContent.classList.remove('hidden');
                    }
                } else {
                    // Garante que o alerta esteja escondido se for o √∫ltimo passo (Desacelera√ß√£o)
                    nextStepAlert.classList.add('hidden');
                }
                // --- FIM L√≥gica do Alerta ---


                // 2. Atualiza o display (tempo do passo e tempo total)
                updateDisplay();

                // 3. Verifica se o passo atual terminou
                if (stepTimeRemaining <= 0) {
                    currentStepIndex++; // Move para o pr√≥ximo passo

                    // 4. Verifica se o treino terminou
                    if (currentStepIndex >= workoutSteps.length) {
                        stopWorkout(true); // Treino conclu√≠do
                        playBeep(1200, 500); // Bipe final de conclus√£o
                        return;
                    }

                    // 5. Configura o novo passo e toca o bipe de transi√ß√£o
                    stepTimeRemaining = workoutSteps[currentStepIndex].duration;
                    
                    const nextStepType = workoutSteps[currentStepIndex].type;
                    if (nextStepType === 'run') {
                        playBeep(880, 200); // Tom alto para CORRIDA
                    } else if (nextStepType === 'ramp') {
                        playBeep(700, 200); // Tom m√©dio para ACELERA√á√ÉO
                    } else { // walk (recovery/cooldown)
                        playBeep(550, 200); // Tom baixo para CAMINHADA/RECUPERA√á√ÉO
                    }

                    // 6. Atualiza o display para o novo passo
                    updateDisplay();
                }

            }, 1000);
        }

        /**
         * Pausa o treino.
         */
        function pauseWorkout() {
            if (state !== 'running' && state !== 'countdown') return;
            
            clearInterval(timerInterval);
            state = 'paused';
            
            // Garante que o display principal do cron√¥metro esteja vis√≠vel e mostra o estado de pausa
            countdownDisplay.classList.add('hidden');
            mainTimerDisplay.classList.remove('hidden');
            nextStepAlert.classList.add('hidden'); // Esconde o alerta se pausado
            
            // Garante que os displays principais voltem a aparecer se estiverem escondidos pelo alerta
            mainDisplayContent.classList.remove('hidden');

            updateUI();
            currentIntervalTypeDisplay.textContent = 'PAUSADO üõë';
        }

        /**
         * Para o treino completamente.
         * @param {boolean} [completed=false] - Se o treino terminou por conclus√£o de todos os passos.
         */
        function stopWorkout(completed = false) {
            clearInterval(timerInterval);
            state = completed ? 'finished' : 'stopped';
            nextStepAlert.classList.add('hidden'); // Esconde o alerta se parado
             // Garante que os displays principais voltem a aparecer para o reset
            mainDisplayContent.classList.remove('hidden');
            updateUI();

            if (!completed) {
                // Se n√£o foi conclu√≠do, limpa o estado de tempo
                currentStepIndex = 0;
                stepTimeRemaining = 0;
                updateDisplay();
            }
        }

        /**
         * Reseta o aplicativo para o estado inicial.
         */
        function resetWorkout() {
            clearInterval(timerInterval);
            state = 'stopped';
            currentStepIndex = 0;
            stepTimeRemaining = 0;
            workoutSteps = [];
            profile = null;
            nextStepAlert.classList.add('hidden');
            
            // Garante que os displays principais estejam vis√≠veis na configura√ß√£o
            mainDisplayContent.classList.remove('hidden');
            
            updateUI();
            updateDisplay();
            updatePreview(); // Gera a pr√©-visualiza√ß√£o inicial
        }

        // Inicializa a interface e a pr√©-visualiza√ß√£o ao carregar
        document.addEventListener('DOMContentLoaded', resetWorkout);

    </script>
</body>
</html>
